<!doctype html>
<html class="x-admin-sm">
<head>
<meta charset="UTF-8">
<title>ZennoProxy</title>
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link href="../favicon.png" rel="shortcut icon" type="image/x-icon"/>
<link href="../layui/css/layui.css" rel="stylesheet">
<link rel="stylesheet" href="../css/xadmin-while.css">
<script src="../layui/layui.js" charset="utf-8"></script>
<script src="../js/xadmin.js" charset="utf-8"></script>
<script>
	var is_remember = false;
</script>
<style>
.layui-layer-btn .layui-layer-btn0{display: inline-block;vertical-align: middle;height: 38px;line-height: 38px;border: 1px solid transparent;padding: 0 18px;background-color: #16baaa;color: #fff;white-space: nowrap;text-align: center;font-size: 14px;border-radius: 2px;cursor:pointer;-moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;}
.layui-layer-btn a{display: inline-block;vertical-align: middle;height: 38px;line-height: 38px;padding: 0 18px;white-space: nowrap;text-align: center;font-size: 14px;border-radius: 2px;cursor:pointer;-moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;}
</style>
</head>
<body>
<div class="top-box">
	<div class="logo"><span></span></div>		
	<div class="right-nav">
		<div class="tb-center">
			<a href="javascript:;" class="layui-btn layui-btn-primary layui-btn-radius btn1">Requestor</a>
			<span>———————<i class="layui-edge layui-edge-right" style="border-left-color: black;"></i><font>Port 24000-25000</font></span>
			<a href="javascript:;"  class="layui-btn layui-btn-primary layui-btn-radius btn2">Proxy Manager</a>
			<span>———————<i class="layui-edge layui-edge-right" style="border-left-color: black;"></i><font>Port 12569</font></span>
			<a href="javascript:;"  class="layui-btn layui-btn-primary layui-btn-radius btn1">Super Proxy</a>
			<span>———————<i class="layui-edge layui-edge-right" style="border-left-color: black;"></i><font>Port 80,443</font></span>
			<a href="javascript:;" class="layui-btn layui-btn-primary layui-btn-radius btn1">P2P Nodes</a>
			———<i class="layui-edge layui-edge-right" style="border-left-color: black;"></i>
			<a href="javascript:;" class="layui-btn layui-btn-primary layui-btn-radius btn1">Destination</a>
		</div>
		<ul class="layui-nav layui-bg-gray right">
			<li class="layui-nav-item">
			<a href="javascript:;" class="welcome"></a>
			<dl class="layui-nav-child">
			<dd><a href="javascript:;" onclick="doUpdatePwd()">Update Password</a></dd>
			<dd><a href="javascript:;" onclick="doLogout()">Logout</a></dd>
			</dl>
			</li>                
		</ul>
	</div>
</div>
<div class="left-nav">
	<div id="side-nav">	
		<ul id="nav">
			<li><a onclick="change_iframe('../user/main.html')" class="active"><i class="layui-icon"><img src="../images/laptop.png"/></i></a></li>
			<li><a onclick="change_iframe('../user/ad.html')" id="lamp"><i class="layui-icon"><img src="../images/lamp.png"/></i></a></li>
			<li><a onclick="change_iframe('../user/chart.html')" id="chart"><i class="layui-icon"><img src="../images/chart.png"/></i></a></li>
			<!-- <li><a onclick="change_iframe('')"><i class="layui-icon" id="adjust"><img src="../images/adjust.png"/></i></a></li> -->
			<li><a onclick="change_iframe('../user/setting.html')"><i class="layui-icon"><img src="../images/setting.png"/></i></a></li>
			<li><a onclick="change_iframe('../user/api.html')"><i class="layui-icon"><img src="../images/api.png"/></i></a></li>
			<li><a onclick="change_iframe('../user/help.html')"><i class="layui-icon"><img src="../images/help.png"/></i></a></li>
		</ul>
	</div>
</div>
<div class="x-slide_left"></div>
<div class="page-content">
	<iframe src='../user/main.html' id="myIframe" frameborder="0" class="x-iframe"></iframe>
</div>
<script>
layui.extend({
	common: '../modules/common'
});
layui.use(['form','layer','common'],function(){	
	var $ = layui.jquery
		,layer = parent.layer === undefined ? layui.layer : top.layer
		,form = layui.form
		,common = layui.common;
	
	
	var user = JSON.parse(localStorage.getItem("user"));
	if(user == null){
		window.location.href='../login.html';  
	}else{
		var welcome = "Welcome," + user.user_name;
		$(".welcome").text(welcome);
	}
	var server = common.get_server_ip();
	
	window.change_iframe = function(url){
		$(this).addClass("active");
		$("#nav li a").siblings().removeClass('active');
		$(".x-iframe").attr("src", url);
	}
	
	window.doUpdatePwd = function(){
		var index_pwd = layer.open({
			type: 1,
			title: ["Update Password", 'font-size:14px;font-weight:bold'],
			area: ["360px","280px"],
			resize: false,
			content: `
				<div class="layui-fluid dialog_index">
					<form class="layui-form layui-form-pane" action="" style="padding-top: 15px;">	
					<div class="layui-input-wrap">
						<div class="layui-input-prefix">
							<i class="layui-icon layui-icon-password"></i>
						</div>
						<input type="password" name="old_password" value="" lay-verify="required|pass" placeholder="old password" autocomplete="off" class="layui-input" lay-affix="eye">
					</div>
					<div class="layui-input-wrap">
						<div class="layui-input-prefix">
							<i class="layui-icon layui-icon-password"></i>
						</div>
						<input type="password" name="password" value="" lay-verify="required|pass" placeholder="new password" autocomplete="off" class="layui-input" lay-affix="eye">
					</div>
					<div class="layui-input-wrap">
						<div class="layui-input-prefix">
							<i class="layui-icon layui-icon-password"></i>
						</div>
						<input type="password" name="repassword" value="" lay-verify="required|pass|confirmPassword" placeholder="confirm password" autocomplete="off" class="layui-input" lay-affix="eye">
					</div>
					<div class="layui-form-item">
						<button class="layui-btn" lay-filter="queding" lay-submit="">submit</button>
					</div>
					</form>	
				</div>
			`,
			success: function(){
				form.render();
				form.verify({
					required: function(value){
						if(value.length == 0){
							return 'Required items cannot be empty!';
						}
					},
					pass: function(value){
						if(value.length < 5){
							return 'At least 5 characters required!';
						}
					},
					confirmPassword: function(value){
						if($('input[name=password]').val()!=value){
							return 'The two password entries do not match!';
						}
					}
				});				
				
				form.on('submit(queding)', function(data){
					var field = data.field; 				
					var url = server + 'user/changePassword/' + user.user_name + '/' + field.old_password + '/' + field.password;
					var settings = {
					  "url": url,
					  "method": "PUT",
					  "timeout": 0,
					};
					$.ajax(settings).done(function (res) {
						if(res.success){
							layer.msg(res.message,{time: 1000}, function(){
								layer.close(index_pwd);
							}); 					
						}else{
							layer.msg(res.message);
						}
					});
					return false;
				});
			}
		});
	}
	
	window.doLogout = function(){
		localStorage.clear();
		window.location.href='../login.html';  
	}
});
</script>
</body>
</html>