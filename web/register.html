<!DOCTYPE html>
<html  class="loginHtml">
<head>
    <meta charset="UTF-8"/>
	<title>register</title>
    <meta http-equiv="X-UA-Compatible" content="chrome=1,IE=edge"/>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="robots" content="noindex,nofollow">
	<link href="./favicon.png" rel="shortcut icon" type="image/x-icon"/>
    <link href="./layui/css/layui.css" rel="stylesheet">
    <link href="./css/login.css" rel="stylesheet">
    <script src="./layui/layui.js"></script>
</head>
<body class="loginBody register">
	<form class="layui-form" id="login-form" method="post">
        <div class="login_face"><img src="./images/login_bg.png" class="userAvatar"></div>
		<div class="layui-input-wrap">
			<div class="layui-input-prefix">
				<i class="layui-icon layui-icon-username"></i>
			</div>
			<input type="text" name="username" placeholder="user name" lay-verify="required" autocomplete="off" class="layui-input" lay-affix="clear">
		</div>	
		<div class="layui-input-wrap">
			<div class="layui-input-prefix">
				<i class="layui-icon layui-icon-password"></i>
			</div>
			<input type="password" name="password" value="" lay-verify="required|pass|myCustom" placeholder="password" autocomplete="off" class="layui-input" id="reg-password" lay-affix="eye">
		</div>
		<div class="layui-input-wrap">
			<div class="layui-input-prefix">
				<i class="layui-icon layui-icon-password"></i>
			</div>
			<input type="password" name="confirmPassword" value="" lay-verify="required|pass|myCustom|confirmPassword" placeholder="confirm password" autocomplete="off" class="layui-input" lay-affix="eye">
		</div>
		<div class="layui-input-wrap">
			<div class="layui-input-prefix">
				<i class="layui-icon layui-icon-vercode"></i>
			</div>
			<input type="text" name="invite_code" placeholder="Invite code" lay-verify="required" autocomplete="off" lay-verify="required" class="layui-input">
		</div>
		<div class="layui-form-item">
			<button class="layui-btn layui-btn-fluid" style="background-color:#00A1e7;" lay-filter="register" lay-submit="">register</button>
		</div>
	</form>
</body>
<script>
layui.extend({
	common: './modules/common'
});
layui.use(['form','layer','common'],function(){	
	var $ = layui.jquery
		,layer = parent.layer === undefined ? layui.layer : top.layer
		,form = layui.form
		,common = layui.common;
	
	form.verify({
		required: function(value){
			if(value.length == 0){
				return 'Required items cannot be empty!';
			}
		},
		pass: function(value){
			if(value.length < 12){
				return 'At least 12 characters required!';
			}
			if(value.length > 20){
				return 'Can only have a maximum of 20 characters!';
			}
		},
		myCustom:function(value){
			if(!common.isAlphanumeric(value)){
				return 'Password functions are numbers or letters!';
			}
		},
		confirmPassword: function(value){
			if($('input[name=password]').val()!=value){
				return 'The two password entries do not match!';
			}
		}
	});
	
	var server = common.get_login_ip();
    form.on("submit(register)",function(data){		
		var data = data.field;
		var name = data.username;
		if (name.slice(-10) !== "@gmail.com") {
			parent.layer.msg("Only support gmail email!");
			$('input[name="username"]').focus();
			return false;
		}
		var url = server + 'user/register';
		const requestData = {
			"name": data.username,
			"password": data.password,
			"invite_code": data.invite_code
		};
		var settings = {
		  "url": url,
		  "method": "POST",
		  "timeout": 0,
		  "data": requestData,
		};
		
		$.ajax(settings).done(function (res) {
			if(res.success){
				layer.msg(res.message,{time: 1000}, function(){						
					window.location.href= './login.html';   
				}); 					
			}else{
				layer.msg(res.message);
			}
		});	
		return false;  
    })
	
    $(".loginBody .layui-input-wrap").click(function(e){
        e.stopPropagation();
        $(this).addClass("layui-input-focus").find(".layui-input").focus();
    })
	
    $(".loginBody .layui-input-wrap .layui-input").focus(function(){
        $(this).parents('.layui-input-wrap').addClass("layui-input-focus");
    })
	
    $(".loginBody .layui-input-wrap .layui-input").blur(function(){
        $(this).parents('.layui-input-wrap').removeClass("layui-input-focus");
        if($(this).val() != ''){
            $(this).parents('.layui-input-wrap').addClass("layui-input-active");
        }else{
            $(this).parents('.layui-input-wrap').removeClass("layui-input-active");
        }
    })
	
});
</script>
</html>