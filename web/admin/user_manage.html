<!doctype html>
<html class="x-admin-sm">
<head>
<meta charset="UTF-8">
<title>ZennoProxy</title>
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link href="../favicon.png" rel="shortcut icon" type="image/x-icon"/>
<link href="../layui/css/layui.css" rel="stylesheet">
<link href="../css/xadmin-black.css" rel="stylesheet">
<link href="../css/font-awesome/css/font-awesome.min.css?page=index" rel="stylesheet">
<link href="../css/font.css" rel="stylesheet">
<script src="../layui/layui.js" charset="utf-8"></script>
<script src="../js/xadmin.js" charset="utf-8"></script>
<script>
	var is_remember = false;
</script>
</head>
<body class="index">
<div class="container">
	<div class="logo">
		<a href="./user_manage.html"><img src="../images/logo_z.png" class="img"/>ZennoProxy</a></div>
	<div class="left_open">
		<a><i title="Expand the left menu" class="fa fa-list"></i></a>
	</div>			
	<ul class="layui-nav left fast-add">
		
	</ul>
	<ul class="layui-nav right" lay-filter="">
		<li class="layui-nav-item">
			<a href="javascript:;" ><span class="welcome"></span></a>
			<dl class="layui-nav-child">
				<dd><a href="javascript:;" onclick="doUpdatePwd()">Update Password</a></dd>
				<dd><a href="javascript:;" onclick="doLogout()">Logout</a></dd>
			</dl>
		</li>                
	</ul>
</div>		
<div class="left-nav">
	<div id="side-nav">				
		<ul id="nav">
			<li>
				<a onclick="xadmin.add_tab('Standby Manager','/admin/usage.html')">
					<i class="layui-icon layui-icon-slider"></i>
					<cite>Standby Manager</cite>
				</a>
			</li>
			<li>
				<a onclick="xadmin.add_tab('Traffic management','/admin/usage1.html')">
					<i class="layui-icon layui-icon-test"></i>
					<cite>Traffic management</cite>
				</a>
			</li>
			<!-- <li>
				<a href="javascript:;">
					<i class="layui-icon layui-icon-component"></i>
			        <cite>Static Data Center</cite>
			        <i class="iconfont nav_right">&#xe697;</i>
				</a>
				<ul class="sub-menu">
					<li>
					    <a onclick="xadmin.add_tab('Static Data Center','/admin/static_data_center.html')">
					        <i class="iconfont">&#xe6a7;</i>
					        <cite>Static Data Center</cite>
						</a>
					</li>
					<li>
			            <a onclick="xadmin.add_tab('Purchased List','/admin/purchase_data_center.html')">
			                <i class="iconfont">&#xe6a7;</i>
			                <cite>Purchased List</cite>
						</a>
			        </li>
				</ul>
			</li>
			<li>
				<a href="javascript:;">
					<i class="layui-icon layui-icon-home"></i>
			        <cite>Static Residential</cite>
			        <i class="iconfont nav_right">&#xe697;</i>
				</a>
				<ul class="sub-menu">
					<li>
					    <a onclick="xadmin.add_tab('Static Residential','/admin/static_residential.html')">
					        <i class="iconfont">&#xe6a7;</i>
					        <cite>Static Residential</cite>
						</a>
					</li>
					<li>
			            <a onclick="xadmin.add_tab('Purchased List','/admin/purchase_residential.html')">
			                <i class="iconfont">&#xe6a7;</i>
			                <cite>Purchased List</cite>
						</a>
			        </li>
				</ul>
			</li> -->
		</ul>
	</div>
</div>
<div class="page-content">
	<div class="layui-tab tab" lay-filter="xbs_tab" lay-allowclose="true">
		<ul class="layui-tab-title">
			<li class="home layui-this"><i class="layui-icon">&#xe68e;</i>User Manager</li>
		</ul>
		<div class="layui-unselect layui-form-select layui-form-selected" id="tab_right">
			<dl>
				<dd data-type="this">Close Current</dd>
				<dd data-type="other">Close Other</dd>
				<dd data-type="all">Close All</dd>
			</dl>
		</div>
		<div class="layui-tab-content">
			<div class="layui-tab-item layui-show">
				<iframe src='/admin/custom.html' frameborder="0" scrolling="yes" class="x-iframe"></iframe>
			</div>
		</div>
		<div id="tab_show"></div>
	</div>
</div>     
</body>
<script>
layui.extend({
	common: '../modules/common'
});
layui.use(['form','layer','common'],function(){	
	var $ = layui.jquery
		,layer = parent.layer === undefined ? layui.layer : top.layer
		,form = layui.form
		,common = layui.common;

	var user = JSON.parse(localStorage.getItem("admin"));
	if(user == null){
		window.location.href='../login.html';  
	}else{
		var welcome = "Welcome," + user.user_name;
		$(".welcome").text(welcome);
	}
	var server = 'http://' + user.device_ip + ':12569/';
	
	window.change_iframe = function(url){
		$(this).addClass("active");
		$("#nav li a").siblings().removeClass('active');
		$(".x-iframe").attr("src", url);
	}
	
	window.doUpdatePwd = function(){
		var index_pwd = layer.open({
			type: 1,
			title: ["Update Password", 'font-size:14px;font-weight:bold'],
			area: ["360px","290px"],
			resize: false,
			content: `
				<div class="layui-fluid">
					<form class="layui-form layui-form-pane" action="">	
					<div class="layui-input-wrap" style="padding-bottom: 15px;">
						<div class="layui-input-prefix">
							<i class="layui-icon layui-icon-password"></i>
						</div>
						<input type="password" name="old_password" value="" lay-verify="required|pass" placeholder="old password" autocomplete="off" class="layui-input" lay-affix="eye">
					</div>
					<div class="layui-input-wrap"style="padding-bottom: 15px;">
						<div class="layui-input-prefix">
							<i class="layui-icon layui-icon-password"></i>
						</div>
						<input type="password" name="password" value="" lay-verify="required|pass" placeholder="new password" autocomplete="off" class="layui-input" lay-affix="eye">
					</div>
					<div class="layui-input-wrap"style="padding-bottom: 15px;">
						<div class="layui-input-prefix">
							<i class="layui-icon layui-icon-password"></i>
						</div>
						<input type="password" name="repassword" value="" lay-verify="required|pass|confirmPassword" placeholder="confirm password" autocomplete="off" class="layui-input" lay-affix="eye">
					</div>
					<div class="layui-form-item">
						<button class="layui-btn" lay-filter="queding" lay-submit="">submit</button>
					</div>
					</form>	
				</div>
			`,
			success: function(){
				form.render();
				form.verify({
					required: function(value){
						if(value.length == 0){
							return 'Required items cannot be empty!';
						}
					},
					pass: function(value){
						if(value.length < 5){
							return 'At least 5 characters required!';
						}
					},
					confirmPassword: function(value){
						if($('input[name=password]').val()!=value){
							return 'The two password entries do not match!';
						}
					}
				});				
				
				form.on('submit(queding)', function(data){
					var field = data.field; 				
					var url = server + 'user/changePassword/' + user.user_name + '/' + field.old_password + '/' + field.password;
					var settings = {
					  "url": url,
					  "method": "PUT",
					  "timeout": 0,
					};
					$.ajax(settings).done(function (res) {
						if(res.success){
							layer.msg(res.message,{time: 1000}, function(){
								layer.close(index_pwd);
							}); 					
						}else{
							layer.msg(res.message);
						}
					});
					return false;
				});
			}
		});
	}
	
	window.doLogout = function(){
		localStorage.clear();
		window.location.href='../login.html';  
	}
});
</script>
</html>